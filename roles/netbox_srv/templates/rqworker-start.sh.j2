#!/bin/bash

counter=0
until curl -sf "http://{{ netbox_srv_netbox_name }}:8080/login/" > /dev/null
do
  counter=$((counter + 1))
  echo "Waiting for netbox server to start"
  sleep 10s
  if [ $counter -gt 60 ]; then
    echo "ERROR: failing after waiting for netbox startup over 10 minutes"
    exit 1
  fi
done
/opt/netbox/venv/bin/python /opt/netbox/netbox/manage.py rqworker
